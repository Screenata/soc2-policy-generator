# Vulnerability Monitoring Scanning Patterns (CC7.1-7.2)

For policy: **Vulnerability & Monitoring** (`vulnerability-monitoring`)
See [shared.md](shared.md) for evidence formatting and value usage guidelines.

## Basic Detection

**Dependency Lockfile** - Check for dependency locks:
```
Glob: package-lock.json, yarn.lock, pnpm-lock.yaml, bun.lockb, bun.lock, Gemfile.lock, Cargo.lock, poetry.lock, go.sum, composer.lock
```
File presence indicates reproducible builds with locked dependencies.

## Deep Scanning (Value Extraction)

### Scan Schedule and Severity Configuration

Extract scan frequency, severity thresholds, and fail-on criteria.

**Find files:**
```
Glob: .github/workflows/*.{yml,yaml}, .github/dependabot.yml, .snyk, sonar-project.properties, **/*security*scan*.*
```

**Extract values:**
```
Grep: schedule:\s*\n\s*-\s*cron:\s*['"]([^'"]+)['"]  → scheduled scan cron (multiline)
Grep: (?:fail[_\-]?on[_\-]?severity|failOnCVSS)\s*[:=]\s*['"]?(\w+|\d+)['"]?  → fail-on severity threshold
Grep: (?:audit-level|audit_level)\s*[:=]\s*['"]?(\w+)['"]?  → npm audit level
Grep: open-pull-requests-limit:\s*(\d+)  → Dependabot PR limit
Grep: (?:exclude|ignore)\s*[:=]\s*\[([^\]]+)\]  → scan exclusions
```

**Use in policy text:**
- Instead of: "Vulnerability scanning is performed regularly"
- Write: "Automated vulnerability scanning runs **on every pull request** and on a **weekly schedule** via GitHub Actions (see `.github/workflows/security.yml:5-8`). Vulnerabilities at **HIGH severity or above** block merges. `npm audit` is configured to fail at **moderate** level."

## Example Evidence Table

| Control | Extracted Value | File | Line | Raw Evidence |
|---------|----------------|------|------|-------------|
| Scan schedule | **weekly (cron: 0 0 * * 1)** | .github/workflows/security.yml | 5 | `cron: '0 0 * * 1'` |
| Fail-on severity | **high** | .github/workflows/ci.yml | 45 | `--severity-threshold=high` |
| npm audit level | **moderate** | .github/workflows/ci.yml | 28 | `npm audit --audit-level=moderate` |
| Dependabot PR limit | **10** | .github/dependabot.yml | 8 | `open-pull-requests-limit: 10` |

## Cloud Scanning Cross-Reference

For live infrastructure evidence related to vulnerability monitoring:
- AWS: ECR scanning, Security Hub, GuardDuty, Config rules -- see [aws.md](aws.md#vulnerability--monitoring-cc71-72)
- GCP: Container Analysis, Security Command Center -- see [gcp.md](gcp.md#vulnerability--monitoring-cc71-72)
- Azure: Defender for Cloud assessments, diagnostic settings -- see [azure.md](azure.md#vulnerability--monitoring-cc71-72)
